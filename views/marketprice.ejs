<% layout("/layouts/boilerplate") %>

<div class="market-dashboard">
  <section class="hero-section">
    <div class="container">
      <h1 class="display-4 fw-bold">Global Crop Market Intelligence</h1>
      <p class="lead">Real-time pricing data and analytics for agricultural markets worldwide</p>
      
      <div class="search-container">
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-search"></i></span>
          <input type="text" id="cropSearch" class="form-control" placeholder="Search for crops...">
          <button class="btn btn-accent" id="advancedFilterBtn">
            <i class="fas fa-sliders-h me-2"></i>Filters
          </button>
        </div>
      </div>
    </div>
  </section>

  <section class="market-overview">
    <div class="container">
      <div class="section-header">
        <h2>Market Overview</h2>
        <div class="market-stats">
          <div class="stat-card">
            <span class="stat-icon"><i class="fas fa-chart-line"></i></span>
            <div class="stat-info">
              <h3 id="marketTrend">+2.3%</h3>
              <p>Overall Market Trend</p>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon"><i class="fas fa-bolt"></i></span>
            <div class="stat-info">
              <h3 id="topGainer">Rice +4.8%</h3>
              <p>Top Gainer Today</p>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon"><i class="fas fa-arrow-down"></i></span>
            <div class="stat-info">
              <h3 id="topLoser">Wheat -2.1%</h3>
              <p>Top Decliner Today</p>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon"><i class="fas fa-calendar-alt"></i></span>
            <div class="stat-info">
              <h3 id="lastUpdated">10 mins ago</h3>
              <p>Last Updated</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container">
    <div class="dashboard-controls">
      <div class="view-controls">
        <button class="btn btn-view active" data-view="grid"><i class="fas fa-th-large me-2"></i>Grid</button>
        <button class="btn btn-view" data-view="list"><i class="fas fa-list me-2"></i>List</button>
        <button class="btn btn-view" data-view="comparison"><i class="fas fa-chart-bar me-2"></i>Compare</button>
      </div>
      
      <div class="sort-controls">
        <label for="sortCrops">Sort by:</label>
        <select id="sortCrops" class="form-select">
          <option value="name">Name (A-Z)</option>
          <option value="price-high">Price (High to Low)</option>
          <option value="price-low">Price (Low to High)</option>
          <option value="trending">Trending</option>
          <option value="seasonal">Seasonal</option>
        </select>
      </div>
    </div>
    <div class="market-categories">
      <button class="category-btn active" data-category="all">All Crops</button>
      <button class="category-btn" data-category="grains">Grains</button>
      <button class="category-btn" data-category="vegetables">Vegetables</button>
      <button class="category-btn" data-category="fruits">Fruits</button>
      <button class="category-btn" data-category="pulses">Pulses</button>
      <button class="category-btn" data-category="nuts">Nuts & Seeds</button>
    </div>

    <div class="view-container" id="gridView">
      <div class="row" id="crop-list">
        <% crops.forEach(crop => { %>
          <div class="col-xl-3 col-lg-4 col-md-6 mb-4" data-category="<%= crop.category || 'all' %>">
            <div class="crop-card" data-crop='<%= JSON.stringify(crop) %>'>
              <div class="card-badge <%= crop.trend > 0 ? 'positive' : crop.trend < 0 ? 'negative' : 'neutral' %>">
                <%= crop.trend > 0 ? '+' : '' %><%= crop.trend %>%
              </div>
              <div class="crop-img-container">
                <img src="<%= crop.image %>" class="crop-img" alt="<%= crop.name %>">
              </div>
              <div class="crop-info">
                <h4><%= crop.name %></h4>
                <div class="price-wrapper">
                  <span class="price">₹<%= crop.currentPrice %></span>
                  <span class="unit">per kg</span>
                </div>
                <div class="crop-meta">
                  <span class="meta-item">
                    <i class="fas fa-map-marker-alt"></i> <%= crop.topRegion || 'Multiple Regions' %>
                  </span>
                  <span class="meta-item">
                    <i class="fas fa-warehouse"></i> <%= crop.supply || 'Medium' %> supply
                  </span>
                </div>
                <button class="btn btn-details">View Details</button>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
    <div class="view-container d-none" id="listView">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Crop</th>
            <th>Current Price</th>
            <th>24h Change</th>
            <th>7d Trend</th>
            <th>Supply</th>
            <th>Region</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="crop-list-table">
          <% crops.forEach(crop => { %>
            <tr data-crop='<%= JSON.stringify(crop) %>' data-category="<%= crop.category || 'all' %>">
              <td>
                <div class="crop-name-cell">
                  <img src="<%= crop.image %>" alt="<%= crop.name %>" class="table-crop-img">
                  <span><%= crop.name %></span>
                </div>
              </td>
              <td class="price-cell">₹<%= crop.currentPrice %>/kg</td>
              <td class="<%= crop.trend > 0 ? 'positive' : crop.trend < 0 ? 'negative' : 'neutral' %>">
                <%= crop.trend > 0 ? '+' : '' %><%= crop.trend %>%
              </td>
              <td>
                <div class="mini-chart" id="miniChart<%= crop.id %>"></div>
              </td>
              <td><%= crop.supply || 'Medium' %></td>
              <td><%= crop.topRegion || 'Multiple Regions' %></td>
              <td>
                <button class="btn btn-sm btn-outline-primary btn-details">Details</button>
                <button class="btn btn-sm btn-outline-secondary btn-compare" data-crop-id="<%= crop.id %>">
                  <i class="fas fa-chart-line"></i>
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <div class="view-container d-none" id="comparisonView">
      <div class="comparison-container">
        <div class="comparison-controls">
          <div class="selected-crops" id="selectedCropsContainer">
            <p>Select up to 4 crops to compare</p>
          </div>
          <div class="comparison-options">
            <select id="comparisonMetric" class="form-select">
              <option value="price">Price</option>
              <option value="trend">Price Trend</option>
              <option value="volatility">Price Volatility</option>
              <option value="volume">Trading Volume</option>
            </select>
            <select id="comparisonPeriod" class="form-select">
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="quarter">This Quarter</option>
              <option value="year">This Year</option>
              <option value="5years">Last 5 Years</option>
            </select>
          </div>
        </div>
        <div class="comparison-chart-container">
          <canvas id="comparisonChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="market-alerts">
  <div class="alerts-header">
    <h3><i class="fas fa-bell me-2"></i>Market Alerts</h3>
    <button class="btn-close-alerts"><i class="fas fa-times"></i></button>
  </div>
  <div class="alerts-body">
    <div class="alert-item">
      <span class="alert-time">09:45 AM</span>
      <p>Rice prices increased by 3.8% due to export restrictions in Thailand</p>
    </div>
    <div class="alert-item">
      <span class="alert-time">08:30 AM</span>
      <p>Unseasonal rainfall in Maharashtra affecting vegetable supply chains</p>
    </div>
    <div class="alert-item">
      <span class="alert-time">Yesterday</span>
      <p>Government announces new MSP for wheat and pulses</p>
    </div>
    <div class="alert-item">
      <span class="alert-time">Yesterday</span>
      <p>Global corn futures down 2.1% amid favorable weather forecasts</p>
    </div>
  </div>
  <div class="alerts-footer">
    <button class="btn btn-sm btn-outline-light">View All Alerts</button>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="alertsToggle" checked>
      <label class="form-check-label" for="alertsToggle">Receive Alerts</label>
    </div>
  </div>
</div>

<button class="alerts-toggle-btn">
  <i class="fas fa-bell"></i>
  <span class="alert-badge">4</span>
</button>


<div class="modal fade" id="filtersModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Advanced Filters</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Price Range</label>
              <div class="price-slider-container">
                <div id="priceRangeSlider"></div>
                <div class="slider-values">
                  <span id="priceRangeMin">₹0</span>
                  <span id="priceRangeMax">₹500</span>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Categories</label>
              <div class="filter-chips">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="filterGrains" value="grains" checked>
                  <label class="form-check-label" for="filterGrains">Grains</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="filterVegetables" value="vegetables" checked>
                  <label class="form-check-label" for="filterVegetables">Vegetables</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="filterFruits" value="fruits" checked>
                  <label class="form-check-label" for="filterFruits">Fruits</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="filterPulses" value="pulses" checked>
                  <label class="form-check-label" for="filterPulses">Pulses</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="filterNuts" value="nuts" checked>
                  <label class="form-check-label" for="filterNuts">Nuts & Seeds</label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Region</label>
              <select class="form-select" id="regionFilter">
                <option value="all">All Regions</option>
                <option value="north">North India</option>
                <option value="south">South India</option>
                <option value="east">East India</option>
                <option value="west">West India</option>
                <option value="central">Central India</option>
                <option value="northeast">Northeast India</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Price Trend</label>
              <select class="form-select" id="trendFilter">
                <option value="all">All Trends</option>
                <option value="up">Rising Prices</option>
                <option value="down">Falling Prices</option>
                <option value="stable">Stable Prices</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Supply Status</label>
              <select class="form-select" id="supplyFilter">
                <option value="all">Any Supply</option>
                <option value="high">High Availability</option>
                <option value="medium">Medium Availability</option>
                <option value="low">Low Availability</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="resetFiltersBtn">Reset Filters</button>
        <button type="button" class="btn btn-primary" id="applyFiltersBtn">Apply Filters</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cropDetailsModal" tabindex="-1">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cropDetailTitle"></h5>
        <div class="modal-title-badges">
          <span class="badge bg-primary" id="cropCategoryBadge">Category</span>
          <span class="badge" id="cropTrendBadge">Trend</span>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-8">
            <div class="chart-controls">
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" data-period="week">Week</button>
                <button type="button" class="btn btn-outline-primary" data-period="month">Month</button>
                <button type="button" class="btn btn-outline-primary" data-period="quarter">Quarter</button>
                <button type="button" class="btn btn-outline-primary" data-period="year">Year</button>
                <button type="button" class="btn btn-outline-primary" data-period="5years">5 Years</button>
              </div>
              <div class="chart-type-selector">
                <select id="chartTypeSelector" class="form-select">
                  <option value="line">Line Chart</option>
                  <option value="bar">Bar Chart</option>
                  <option value="candlestick">Candlestick (OHLC)</option>
                </select>
              </div>
            </div>
            <div class="price-chart-container">
              <canvas id="cropPriceChart"></canvas>
            </div>
            <div class="price-indicators">
              <div class="indicator">
                <span class="indicator-label">Current</span>
                <span class="indicator-value" id="indicatorCurrent">₹0</span>
              </div>
              <div class="indicator">
                <span class="indicator-label">High</span>
                <span class="indicator-value" id="indicatorHigh">₹0</span>
              </div>
              <div class="indicator">
                <span class="indicator-label">Low</span>
                <span class="indicator-value" id="indicatorLow">₹0</span>
              </div>
              <div class="indicator">
                <span class="indicator-label">Avg</span>
                <span class="indicator-value" id="indicatorAvg">₹0</span>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="crop-details-card">
              <img id="cropDetailImage" src="" alt="" class="img-fluid crop-detail-img">
              <div class="crop-summary">
                <div class="summary-item">
                  <span class="summary-label">Current Price</span>
                  <span class="summary-value" id="currentDetailPrice">₹0</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">24h Change</span>
                  <span class="summary-value" id="dailyChange">0%</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Volume</span>
                  <span class="summary-value" id="tradingVolume">0 tons</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Supply Status</span>
                  <span class="summary-value" id="supplyStatus">Medium</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Season</span>
                  <span class="summary-value" id="cropSeason">Year-round</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Top Region</span>
                  <span class="summary-value" id="topProducingRegion">Multiple</span>
                </div>
              </div>
              
              <h5 class="mt-4">Price Forecast</h5>
              <div class="forecast-container">
                <div class="forecast-item">
                  <span class="forecast-period">1 Week</span>
                  <div class="forecast-direction" id="forecast1Week">
                    <i class="fas fa-arrow-up text-success"></i>
                    <span>Slight Increase</span>
                  </div>
                </div>
                <div class="forecast-item">
                  <span class="forecast-period">1 Month</span>
                  <div class="forecast-direction" id="forecast1Month">
                    <i class="fas fa-arrow-up text-success"></i>
                    <span>Moderate Increase</span>
                  </div>
                </div>
                <div class="forecast-item">
                  <span class="forecast-period">3 Months</span>
                  <div class="forecast-direction" id="forecast3Months">
                    <i class="fas fa-equals text-warning"></i>
                    <span>Stable</span>
                  </div>
                </div>
              </div>
              
              <div class="crop-actions mt-4">
                <button class="btn btn-primary w-100 mb-2" id="setAlertBtn">
                  <i class="fas fa-bell me-2"></i>Set Price Alert
                </button>
                <button class="btn btn-outline-primary w-100" id="addToWatchlistBtn">
                  <i class="fas fa-eye me-2"></i>Add to Watchlist
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row mt-4">
          <div class="col-md-6">
            <div class="card mb-3">
              <div class="card-header">
                <h5 class="card-title">Market Insights</h5>
              </div>
              <div class="card-body" id="marketInsights">
                <p>Loading market insights...</p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card mb-3">
              <div class="card-header">
                <h5 class="card-title">Regional Price Comparison</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm" id="regionalPriceTable">
                    <thead>
                      <tr>
                        <th>Region</th>
                        <th>Price (₹/kg)</th>
                        <th>Diff</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="exportDataBtn">
          <i class="fas fa-download me-2"></i>Export Data
        </button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="priceAlertModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Set Price Alert for <span id="alertCropName"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="priceAlertForm">
          <div class="mb-3">
            <label class="form-label">Alert Type</label>
            <select class="form-select" id="alertType">
              <option value="above">Price rises above</option>
              <option value="below">Price falls below</option>
              <option value="percent-up">Price increases by percentage</option>
              <option value="percent-down">Price decreases by percentage</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Price Threshold (₹)</label>
            <input type="number" class="form-control" id="priceThreshold" min="1" step="0.5">
            <div class="form-text" id="thresholdHelper">
              Current price: ₹<span id="alertCurrentPrice"></span>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Notification Method</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="notifyEmail" checked>
              <label class="form-check-label" for="notifyEmail">
                Email Notification
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="notifySMS">
              <label class="form-check-label" for="notifySMS">
                SMS Notification
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="notifyPush" checked>
              <label class="form-check-label" for="notifyPush">
                Push Notification
              </label>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Alert Expiration</label>
            <select class="form-select" id="alertExpiration">
              <option value="1day">1 Day</option>
              <option value="1week" selected>1 Week</option>
              <option value="1month">1 Month</option>
              <option value="3months">3 Months</option>
              <option value="never">Never (Until Triggered)</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveAlertBtn">Set Alert</button>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.6.1/dist/nouislider.min.css">

<style>
:root {
  --primary-teal: #20b2aa;
  --secondary-teal: #008080;
  --dark-teal: #005f73;
  --accent-green: #2ecc71;
  --background-light: #f0f4f4;
  --text-primary: #2c3e50;
  --card-bg: #ffffff;
  --positive-color: #2ecc71;
  --negative-color: #e74c3c;
  --neutral-color: #95a5a6;
  --border-radius: 0.75rem;
  --transition-speed: 0.3s;
  --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

body {
  background-color: var(--background-light);
  color: var(--text-primary);
  padding-top: 70px; 
}

.market-dashboard {
  padding-bottom: 60px;
}

.container {
  max-width: 1400px;
}

.btn-accent {
  background-color: var(--accent-green);
  color: white;
  border: none;
  transition: all var(--transition-speed) ease;
}

.btn-accent:hover {
  background-color: #27ae60;
  color: white;
}

.btn-view {
  background: none;
  border: 1px solid #dee2e6;
  transition: all var(--transition-speed) ease;
}

.btn-view.active {
  background-color: var(--primary-teal);
  color: white;
  border-color: var(--primary-teal);
}

.btn-details {
  background-color: var(--primary-teal);
  color: white;
  border: none;
  border-radius: 0.5rem;
  padding: 0.5rem 1rem;
  transition: all var(--transition-speed) ease;
  width: 100%;
  margin-top: 1rem;
}

.btn-details:hover {
  background-color: var(--dark-teal);
  transform: translateY(-2px);
}

.section-header {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.hero-section {
  background: linear-gradient(135deg, var(--secondary-teal), var(--primary-teal));
  color: white;
  padding: 3rem 0;
  border-radius: 0 0 var(--border-radius) var(--border-radius);
  margin-bottom: 2rem;
}

.hero-section h1 {
  margin-bottom: 0.5rem;
}

.search-container {
  margin-top: 2rem;
  max-width: 700px;
}

.search-container .input-group {
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  border-radius: 50px;
  overflow: hidden;
}

.search-container .input-group-text {
  background-color: white;
  border: none;
  padding-left: 1.5rem;
}

.search-container .form-control {
  border: none;
  padding: 0.75rem 1.5rem 0.75rem 0.5rem;
  font-size: 1.1rem;
}

.search-container .btn {
  border-radius: 0 50px 50px 0;
  padding-left: 1.5rem;
  padding-right: 1.5rem;
}

.market-overview {
  margin-bottom: 2rem;
}

.market-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
}

.stat-card {
  background-color: var(--card-bg);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  display: flex;
  align-items: center;
  box-shadow: var(--box-shadow);
  transition: transform var(--transition-speed) ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-icon {
  background-color: rgba(32, 178, 170, 0.15);
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: var(--primary-teal);
  margin-right: 1rem;
}

.stat-info h3 {
  font-size: 1.5rem;
  margin-bottom: 0.25rem;
  font-weight: 700;
}

.stat-info p {
  margin: 0;
  color: #6c757d;
  font-size: 0.9rem;
}


.dashboard-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.view-controls, .sort-controls {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-controls label {
  margin-right: 0.5rem;
  white-space: nowrap;
}

.form-select {
  border-radius: 0.5rem;
  border: 1px solid #dee2e6;
  padding: 0.5rem;
}

.market-categories {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin-bottom: 2rem;
}

.category-btn {
  padding: 0.5rem 1.25rem;
  border: 1px solid #dee2e6;
  border-radius: 50px;
  background: none;
  transition: all var(--transition-speed) ease;
  font-weight: 500;
}

.category-btn.active {
  background-color: var(--primary-teal);
  color: white;
  border-color: var(--primary-teal);
}

.category-btn:hover:not(.active) {
  background-color: #f8f9fa;
  border-color: #dee2e6;
}


.crop-card {
  background-color: var(--card-bg);
  border-radius: var(--border-radius);
  overflow: hidden;
  box-shadow: var(--box-shadow);
  transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
  position: relative;
  height: 100%;
}

.crop-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.card-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background-color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 50px;
  font-weight: 600;
  font-size: 0.85rem;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.card-badge.positive {
  background-color: var(--positive-color);
  color: white;
}

.card-badge.negative {
  background-color: var(--negative-color);
  color: white;
}

.card-badge.neutral {
  background-color: var(--neutral-color);
  color: white;
}

.crop-img-container {
  height: 180px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #f8f9fa;
}

.crop-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.crop-card:hover .crop-img {
  transform: scale(1.05);
}

.crop-info {
  padding: 1.25rem;
}

.crop-info h4 {
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.price-wrapper {
  display: flex;
  align-items: baseline;
  margin-bottom: 1rem;
}

.price {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary-teal);
}

.unit {
  margin-left: 0.5rem;
  font-size: 0.9rem;
  color: #6c757d;
}

.crop-meta {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.meta-item {
  display: flex;
  align-items: center;
  font-size: 0.9rem;
  color: #6c757d;
}

.meta-item i {
  margin-right: 0.5rem;
  color: var(--primary-teal);
}


.table {
  background-color: white;
  border-radius: var(--border-radius);
  overflow: hidden;
  box-shadow: var(--box-shadow);
}

.table th {
  background-color: #f8f9fa;
  font-weight: 600;
  color: var(--text-primary);
  padding: 1rem;
}

.table td {
  padding: 1rem;
  vertical-align: middle;
}

.crop-name-cell {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.table-crop-img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

.mini-chart {
  height: 30px;
  width: 80px;
}

.price-cell {
  font-weight: 600;
  color: var(--primary-teal);
}

.positive {
  color: var(--positive-color);
  font-weight: 600;
}

.negative {
  color: var(--negative-color);
  font-weight: 600;
}

.neutral {
  color: var(--neutral-color);
}

.comparison-container {
  background-color: white;
  border-radius: var(--border-radius);
  padding: 1.5rem;
  box-shadow: var(--box-shadow);
}

.comparison-controls {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.selected-crops {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
}

.comparison-options {
  display: flex;
  gap: 1rem;
}

.comparison-chart-container {
  height: 400px;
}


.market-alerts {
  position: fixed;
  top: 0;
  right: -350px;
  width: 350px;
  height: 100vh;
  background-color: white;
  box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  transition: right var(--transition-speed) ease;
  display: flex;
  flex-direction: column;
}

.market-alerts.active {
  right: 0;
}

.alerts-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.25rem;
  background-color: var(--primary-teal);
  color: white;
}

.alerts-header h3 {
  margin: 0;
  font-size: 1.25rem;
  display: flex;
  align-items: center;
}

.btn-close-alerts {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 1.25rem;
}

.alerts-body {
  flex-grow: 1;
  overflow-y: auto;
  padding: 1rem;
}

.alert-item {
  padding: 1rem;
  border-bottom: 1px solid #f0f0f0;
}

.alert-time {
  display: block;
  font-size: 0.8rem;
  color: #6c757d;
  margin-bottom: 0.25rem;
}

.alert-item p {
  margin: 0;
}

.alerts-footer {
  padding: 1rem;
  border-top: 1px solid #f0f0f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.alerts-toggle-btn {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background-color: var(--primary-teal);
  color: white;
  border: none;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  z-index: 999;
  transition: transform var(--transition-speed) ease;
}

.alerts-toggle-btn:hover {
  transform: scale(1.1);
}

.alert-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  background-color: #e74c3c;
  color: white;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

.modal-content {
  border-radius: var(--border-radius);
  overflow: hidden;
  border: none;
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
}

.modal-header {
  display: flex;
  align-items: center;
  background-color: #f8f9fa;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #f0f0f0;
}

.modal-title-badges {
  display: flex;
  gap: 0.5rem;
  margin-left: 1rem;
}

.modal-body {
  padding: 1.5rem;
}

.modal-footer {
  border-top: 1px solid #f0f0f0;
  padding: 1.25rem 1.5rem;
}

.chart-controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.price-chart-container {
  height: 350px;
  margin-bottom: 1.5rem;
}

.price-indicators {
  display: flex;
  justify-content: space-between;
  margin-top: 1rem;
}

.indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.indicator-label {
  font-size: 0.85rem;
  color: #6c757d;
}

.indicator-value {
  font-size: 1.25rem;
  font-weight: 600;
}


.crop-details-card {
  background-color: #f8f9fa;
  border-radius: var(--border-radius);
  padding: 1.5rem;
  height: 100%;
}

.crop-detail-img {
  border-radius: var(--border-radius);
  margin-bottom: 1.5rem;
  width: 100%;
}

.crop-summary {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.summary-item {
  display: flex;
  flex-direction: column;
}

.summary-label {
  font-size: 0.85rem;
  color: #6c757d;
}

.summary-value {
  font-size: 1.1rem;
  font-weight: 600;
}

.forecast-container {
  background-color: white;
  border-radius: var(--border-radius);
  padding: 1rem;
  margin-bottom: 1.5rem;
}

.forecast-item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid #f0f0f0;
}

.forecast-item:last-child {
  border-bottom: none;
}

.forecast-period {
  font-weight: 500;
}

.forecast-direction {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}


.price-slider-container {
  padding: 0 10px;
  margin-top: 1rem;
}

.slider-values {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
}


@media (max-width: 992px) {
  .crop-summary {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .market-stats,
  .dashboard-controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .stat-card {
    flex-direction: column;
    text-align: center;
  }
  
  .stat-icon {
    margin-right: 0;
    margin-bottom: 1rem;
  }
  
  .chart-controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .view-controls, .sort-controls {
    width: 100%;
    justify-content: space-between;
  }
  
  .modal-dialog {
    margin: 0.5rem;
  }
  
  .price-indicators {
    flex-wrap: wrap;
    gap: 1rem;
  }
}

@media (max-width: 576px) {
  .crop-summary {
    grid-template-columns: 1fr;
  }
  
  .comparison-controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .comparison-options {
    flex-direction: column;
    width: 100%;
  }
}


@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.crop-card, .stat-card {
  animation: fadeIn 0.5s ease forwards;
}


.col-xl-3:nth-child(1) .crop-card { animation-delay: 0.05s; }
.col-xl-3:nth-child(2) .crop-card { animation-delay: 0.1s; }
.col-xl-3:nth-child(3) .crop-card { animation-delay: 0.15s; }
.col-xl-3:nth-child(4) .crop-card { animation-delay: 0.2s; }
.col-xl-3:nth-child(5) .crop-card { animation-delay: 0.25s; }
.col-xl-3:nth-child(6) .crop-card { animation-delay: 0.3s; }
.col-xl-3:nth-child(7) .crop-card { animation-delay: 0.35s; }
.col-xl-3:nth-child(8) .crop-card { animation-delay: 0.4s; }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.6.1/dist/nouislider.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {

  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.forEach(function(tooltipTriggerEl) {
    new bootstrap.Tooltip(tooltipTriggerEl);
  });
  const filtersModal = new bootstrap.Modal(document.getElementById('filtersModal'));
  const cropDetailsModal = new bootstrap.Modal(document.getElementById('cropDetailsModal'));
  const priceAlertModal = new bootstrap.Modal(document.getElementById('priceAlertModal'));
  const alertsToggleBtn = document.querySelector('.alerts-toggle-btn');
  const closeAlertsBtn = document.querySelector('.btn-close-alerts');
  const marketAlerts = document.querySelector('.market-alerts');

  alertsToggleBtn.addEventListener('click', () => {
    marketAlerts.classList.add('active');
  });

  closeAlertsBtn.addEventListener('click', () => {
    marketAlerts.classList.remove('active');
  });

  document.getElementById('advancedFilterBtn').addEventListener('click', () => {
    filtersModal.show();
  });

  const viewBtns = document.querySelectorAll('.btn-view');
  const viewContainers = document.querySelectorAll('.view-container');

  viewBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const view = this.getAttribute('data-view');

      viewBtns.forEach(b => b.classList.remove('active'));

      this.classList.add('active');

      viewContainers.forEach(container => {
        container.classList.add('d-none');
      });

      document.getElementById(view + 'View').classList.remove('d-none');
    });
  });


  const categoryBtns = document.querySelectorAll('.category-btn');
  const cropItems = document.querySelectorAll('[data-category]');

  categoryBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const category = this.getAttribute('data-category');

      categoryBtns.forEach(b => b.classList.remove('active'));

      this.classList.add('active');

      if (category === 'all') {
        cropItems.forEach(item => {
          item.style.display = '';
        });
      } else {

        cropItems.forEach(item => {
          if (item.getAttribute('data-category') === category) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });
      }
    });
  });


  const detailBtns = document.querySelectorAll('.btn-details');
  
  detailBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const cropCard = this.closest('[data-crop]');
      const cropData = JSON.parse(cropCard.getAttribute('data-crop'));

      document.getElementById('cropDetailTitle').textContent = cropData.name;
      document.getElementById('cropCategoryBadge').textContent = cropData.category || 'All Crops';
      
      const trendBadge = document.getElementById('cropTrendBadge');
      trendBadge.textContent = (cropData.trend > 0 ? '+' : '') + cropData.trend + '%';
      
      if (cropData.trend > 0) {
        trendBadge.className = 'badge bg-success';
      } else if (cropData.trend < 0) {
        trendBadge.className = 'badge bg-danger';
      } else {
        trendBadge.className = 'badge bg-secondary';
      }
      
      document.getElementById('cropDetailImage').src = cropData.image;
      document.getElementById('currentDetailPrice').textContent = '₹' + cropData.currentPrice + '/kg';
      document.getElementById('dailyChange').textContent = (cropData.trend > 0 ? '+' : '') + cropData.trend + '%';
      document.getElementById('tradingVolume').textContent = cropData.volume || 'N/A';
      document.getElementById('supplyStatus').textContent = cropData.supply || 'Medium';
      document.getElementById('cropSeason').textContent = cropData.season || 'Year-round';
      document.getElementById('topProducingRegion').textContent = cropData.topRegion || 'Multiple Regions';

      cropDetailsModal.show();

      initPriceChart(cropData);
    });
  });

  function initPriceChart(cropData) {
    const ctx = document.getElementById('cropPriceChart').getContext('2d');

    const dates = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const prices = generateRandomPrices(cropData.currentPrice, 12);
    
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: cropData.name + ' Price (₹/kg)',
          data: prices,
          borderColor: '#20b2aa',
          backgroundColor: 'rgba(32, 178, 170, 0.1)',
          borderWidth: 2,
          pointBackgroundColor: '#ffffff',
          pointBorderColor: '#20b2aa',
          pointBorderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6,
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(255, 255, 255, 0.9)',
            titleColor: '#2c3e50',
            bodyColor: '#2c3e50',
            borderColor: '#e0e0e0',
            borderWidth: 1,
            padding: 10,
            displayColors: false,
            callbacks: {
              label: function(context) {
                return '₹' + context.raw.toFixed(2) + '/kg';
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: false,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            },
            ticks: {
              callback: function(value) {
                return '₹' + value;
              }
            }
          }
        }
      }
    });
    

    document.getElementById('indicatorCurrent').textContent = '₹' + cropData.currentPrice;
    const highPrice = Math.max(...prices);
    document.getElementById('indicatorHigh').textContent = '₹' + highPrice.toFixed(2);
    const lowPrice = Math.min(...prices);
    document.getElementById('indicatorLow').textContent = '₹' + lowPrice.toFixed(2);
    const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
    document.getElementById('indicatorAvg').textContent = '₹' + avgPrice.toFixed(2);

    const regions = ['North India', 'South India', 'East India', 'West India', 'Central India'];
    const tableBody = document.getElementById('regionalPriceTable').querySelector('tbody');
    tableBody.innerHTML = '';
    
    regions.forEach(region => {
      const regionalPrice = (cropData.currentPrice * (0.9 + Math.random() * 0.2)).toFixed(2);
      const diff = (regionalPrice - cropData.currentPrice).toFixed(2);
      const diffPercent = ((diff / cropData.currentPrice) * 100).toFixed(1);
      
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${region}</td>
        <td>₹${regionalPrice}</td>
        <td class="${diff > 0 ? 'positive' : diff < 0 ? 'negative' : 'neutral'}">
          ${diff > 0 ? '+' : ''}${diff} (${diff > 0 ? '+' : ''}${diffPercent}%)
        </td>
      `;
      
      tableBody.appendChild(row);
    });
    

    document.getElementById('marketInsights').innerHTML = `
      <p>The ${cropData.name} market has shown ${cropData.trend > 0 ? 'a positive' : cropData.trend < 0 ? 'a negative' : 'a stable'} trend in recent weeks.</p>
      <p>Current supply is considered ${cropData.supply || 'Medium'} with main production coming from ${cropData.topRegion || 'multiple regions'}.</p>
      <p>Factors affecting current prices include:</p>
      <ul>
        <li>Seasonal ${cropData.trend > 0 ? 'decrease' : 'increase'} in production</li>
        <li>Changing consumer demand patterns</li>
        <li>Transportation and logistics variables</li>
        <li>Market intervention policies</li>
      </ul>
    `;
  }
  

  document.getElementById('setAlertBtn').addEventListener('click', function() {
    const cropTitle = document.getElementById('cropDetailTitle').textContent;
    const currentPrice = document.getElementById('currentDetailPrice').textContent.replace('₹', '').replace('/kg', '');
    
    document.getElementById('alertCropName').textContent = cropTitle;
    document.getElementById('alertCurrentPrice').textContent = currentPrice;
    document.getElementById('priceThreshold').value = currentPrice;
    
    priceAlertModal.show();
  });

  function generateRandomPrices(basePrice, count) {
    const prices = [];
    let currentPrice = basePrice;
    
    for (let i = 0; i < count; i++) {
      const change = currentPrice * (Math.random() * 0.1 - 0.05); // -5% to +5%
      currentPrice += change;
      prices.push(Math.max(currentPrice, basePrice * 0.7)); // Ensure not too low
    }
    
    return prices;
  }

  if (document.getElementById('priceRangeSlider')) {
    const priceSlider = document.getElementById('priceRangeSlider');
    
    noUiSlider.create(priceSlider, {
      start: [0, 500],
      connect: true,
      range: {
        'min': 0,
        'max': 500
      },
      step: 10,
      format: {
        to: function(value) {
          return Math.round(value);
        },
        from: function(value) {
          return Number(value);
        }
      }
    });
    
    const minPriceDisplay = document.getElementById('priceRangeMin');
    const maxPriceDisplay = document.getElementById('priceRangeMax');
    
    priceSlider.noUiSlider.on('update', function(values, handle) {
      if (handle === 0) {
        minPriceDisplay.textContent = '₹' + values[handle];
      } else {
        maxPriceDisplay.textContent = '₹' + values[handle];
      }
    });
  }
});
</script>